package sendinblue;

import org.apache.commons.lang3.StringEscapeUtils;
import org.apache.commons.lang3.StringUtils;
import org.hamcrest.CoreMatchers;
import org.junit.Test;
import sibModel.SendEmail;
import sibModel.SendEmailAttachment;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Collections;

import static java.util.Base64.getEncoder;
import static org.junit.Assert.assertThat;

public class JsonTest {

    private Json jsonToTest = new Json();

    private static final String XYZ_FILE_BASE64_CODE = "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dWRpbyAyLjUpCi9OZXh0IDEyIDAgUgo+PgplbmRvYmoKMTIgMCBvYmoKPDwKL1BhcmVudCAyIDAgUgovRGVzdCBbNSAwIFIgL1hZWiAwIDc2OSAwLjAwMF0KL1RpdGxlIChTU0wgVHV0b3JpYWwpCi9QcmV2IDExIDAgUgo+PgplbmRvYmoKMTMgMCBvYmoKPDwKL0NyZWF0b3IgKEV2ZW50SGVsaXguY29tL0V2ZW50U3R1ZGlvIDIuNSkKL0NyZWF0aW9uRGF0ZSAoRDoyMDA0MDcxNDIzNTQzNSkKL1Byb2R1Y2VyIChbQ2xpYlBERiBMaWJyYXJ5IDIuMDItcjEtMV0gV2luZG93cyA5eC9OVCkKL0F1dGhvciAoVXNlcjogV2luZG93cyBOVC85NS85OCBVc2VyKQovVGl0bGUgKFNTTCBUdXRvcmlhbCkKL1N1YmplY3QgKE1lc3NhZ2UgU2VxdWVuY2UgQ2hhcnQpCi9LZXl3b3JkcyAoTWVzc2FnZSBTZXF1ZW5jZSBDaGFydCwgU2NlbmFyaW8gRGlhZ3JhbSkKPj4KZW5kb2JqCnhyZWYKMCAxNAowMDAwMDAwMDAwIDY1NTM1IGYgCjAwMDAwMDAwMzMgMDAwMDAgbiAKMDAwMDAwMDEyMSAwMDAwMCBuIAowMDAwMDAwMTk0IDAwMDAwIG4gCjAwMDAwMDAyNTkgMDAwMDAgbiAKMDAwMDAwMDI4NyAwMDAwMCBuIAowMDAwMDAwNDgwIDAwMDAwIG4gCjAwMDAwMDM1MTMgMDAwMDAgbiAKMDAwMDAwMzcwNiAwMDAwMCBuIAowMDAwMDA1MDQxIDAwMDAwIG4gCjAwMDAwMDUxNTMgMDAwMDAgbiAKMDAwMDAwNTI2NyAwMDAwMCBuIAowMDAwMDA1NDMzIDAwMDAwIG4gCjAwMDAwMDU1MzUgMDAwMDAgbiAKdHJhaWxlcgo8PAovU2l6ZSAxNAovUm9vdCAxIDAgUgovSW5mbyAxMyAwIFIKPj4Kc3RhcnR4cmVmCjU4MzMKJSVFT0YK";
    private static final String FILENAME_TO_SERIALIZE =  "xyz.pdf";
    private static final String EMAIL_TO = "meriem@sendinblue.com";
    private static final String EXPECTED_JSON_PAYLOAD = "{\"emailTo\":[\"meriem@sendinblue.com\"],\"attachment\":[{\"content\":\"JVBERi0xLjIKekdf1fnfSqQYt7AjczYfpmRSIEyEcx8KMSAwIG9iago8PAovVHlwZSAvQ2F0YWxvZwovUGFnZXMgMyAwIFIKL091dGxpbmVzIDIgMCBSCi9QYWdlTW9kZSAvVXNlT3V0bGluZXMKPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1R5cGUgL091dGxpbmVzCi9Db3VudCAyCi9GaXJzdCAxMSAwIFIKL0xhc3QgMTIgMCBSCj4+CmVuZG9iagozIDAgb2JqCjw8Ci9UeXBlIC9QYWdlcwovQ291bnQgMgovS2lkcyBbIDUgMCBSIDcgMCBSIF0KPj4KZW5kb2JqCjQgMCBvYmoKWy9QREYgL1RleHRdCmVuZG9iago1IDAgb2JqCjw8Ci9UeXBlIC9QYWdlCi9QYXJlbnQgMyAwIFIKL1Jlc291cmNlcyA8PAovRm9udCA8PAovRmNwZGYwIDkgMCBSCi9GY3BkZjEgMTAgMCBSCj4+Ci9Qcm9jU2V0IDQgMCBSID4+Ci9NZWRpYUJveCBbMCAwIDYxMiA3OTJdCi9Dcm9wQm94IFswIDAgNjEyIDc5Ml0KL1JvdGF0ZSAwCi9Db250ZW50cyA2IDAgUgo+PgplbmRvYmoKNiAwIG9iago8PAovTGVuZ3RoIDI5NTgKL0ZpbHRlciBbL0ZsYXRlRGVjb2RlXQo+PgpzdHJlYW0KeJzNWm1v3LgR/u5fwW9NUEfRu1YB+sFxfIh7viSw964o6uIgS9wVa620J0rebP9R/2Vn+CJR2rUt2UFR4HCOGYp8ZuaZZ4ZkXM+ybZtEQSR+BmEofjqu+FHTk5uTk4/Lk/c/pdtsBeO2GF+uThz8g03swQ816C7kzyiE8QDnb07e3NxckWXbVDVLCnI7+PX27Vuy/NfJxdLYy5m4lwObRV4QkciPLSdSm12WDa1L2uh1XWWmH4ifru9aQeQ8YubUrSPH8p0oJpEX9TufF4yWct8nYceOtYgW4fDjG1o/0HoM2vNUTBzLhS9M0I7vi7Gn5sw3LHSsIHDBMDcwsEHAphq3gO0dLzxc4LiBrvO8gU/MccNARDPyYjHowbo+wHcWek43Q61yOGNI88UUL3kQ/4UXRYJVbhxKKy8ewEOfacG+W2m1eS9+vWnajFUEOHeM59M2W0SWbzuwmRtZXuDKzRz/3V/b4p3tE9f7EPiQVt+SNSXOaxLK9RW7bc9gdbXd12ydN+Q/xIW/fQf/88nQVnJZphY5KwpyjTM5uaYcw51Z5FnG6E3DhbHpMmeccPpHS8uUkowl6zrZkIzytGZ3lJMmpwRJta2rlHLOyjVJykwM3yWcpSSt99umgq+2+Z6kFayyBVglpTCpIm2Z0Zo3+AmuUm1pnTSsKhXcnp9hFA/E0TO4Z1suCtzuBICHvtcxbNMNOHKgQKLavhWLvNKTuhFjlnLJ7hWxCyGDB3kHjkwIr7bg0YalwkwCXkX/4B95mtMNBc8lDckqcG1ZNWDfHy2rqfBnKhK/c6+Ia41OTOo6KYFyq6rGHWha04bc0z3+3R0l9Hua499n8Euzo7SczoTAMGEEQW3/8eKnr9cXAlADKHiSCmOQNE1SN0g8tL3lYNC2vStY+n5bs4ekoYiQI0SgzgPLKEBfFfQ7uyvoY25JkxJsmA7fN+Bz2rRbAosIqAyWrFbKj2lbD9DPyRXXMQseafZbCG1xaAAfh1D5b1e1BQZGR1pmBaejQKL1ecJhIi3BYRQSacXWLc5n5RF2TDfAGfhIYNokac5Kyi1QE8LbNEcwwopTcysJHbEqNxq0U/aLv8mSJrHIsqfs6MNkM/p6OnjbAJ/R8ZY3uHJRrUGFku0WQHPtrD53lC0ZuF7FXigexFEQZOjqHiWkMnAGM5S3rEmQs5h9f6N3KHs0m2xCEA/8L6iI6FgqKANhZ+VDVTxQsmFFAQA5wgLf1Zzs8gpI8YA4ACiD/Q03KlHYiEixJje5Ls2fQXOo20Mt4wgJAYKvIH/B/g252wMuUQD4frOhTQ1+R1eJ2HPauy2jK6CXYO42YbWwSGqDoK+pD1DLZOaUgiXtek15w2cxPDB1WG2DDgLkq5rSAlz1kLBCxBDFtNzfVdleEtaAgvPvy2pXkqosBMd7IsnJwj4Rj2ZXEbbZVjUUtgb9A2WtAfp9mOFxU7tu30A3QT4BqXVioZjvzWSUnscBMFFZKOWSqMSATwRy9Z1E/idOTCMt8qml0jYZWAS+10qJBp7O871nWKGQYhlUvuZUCKHgJKasqfK6NaiqY7jncNcZeNI99CSWyZFTzMAjHonA9OXA4YpTSjw6v8GfIVNXbYFUT3SoCvpAi+nwTY1LWtiw7LqHroJJl1yavwrnYschSQsViGNbevuGJ/s+owYr3L4d6LuKAxfVUSiRCF6TFPfC9GoWFfz4mB0aLOY9qilsiYnD4eRI2ErtCCUIe0vwIyar4o4p99q44zGZThXflLkvVaPs7uIp8zApimqHkdWlGioENuEQEaj8Ro0A8TIVWfsTfTtMXijsPf27Mt8TVNg13Ypw1LUdEPQQ1FMaYZGv2Psb1FpTqcG4woAyo94UxV7Fazp6s+eEE82mLZHufXAH+GfogG9q0bJzi9mOytptNm8yg5VXsMJDJ53xPLnXBx3DlbrPNvzVlwQZ0a4Tn5U5Zo/Zl9ZxM4I4VXzhv6wqZUuCtaimCYfOYUb58e2D8vNtgrsamuYlg8OihATh27ZNIjMDHAicQDdtackZlsm8FTRitUgjnuteeMNKtmH/nnVq9RYHMr8ctqUbit5nfIP+wQMoYF+JpmnUDPasEw3h+CjqRcN7Ojd+4iyqz63dWTQM44OzaD+pGzFm/YCzqBcY93K/gsFoanoPnRfWpV+vr+RpDUktesW8abb8w/v3u93O2uzvkvJeXC6MHREEA0c4T/hBO63zgxdGB37oJ3Ujxqxn/PDYjc7LbjQ9vPIKIuJ5C8tb6M7371+0C7QVnq8QO3EkEasRRPyPfxKbZL0xRyZr8/oRfQkx/qo4yU8+zr+0cvB+zUVL3NAKPHVDtjz/9vs36E/JX4jve89fJvraHbBat8gr7rfkXaAv3NsR80z3glBQS9pdJBipqtSfc3VSA12toRYDn+FYAJWG8Rylh4B5zwtHh8FdmBWn27qSZ8XPy+W3G1yRCIdpdz1q9wtv0G0rdmxwsB1YjsG3P5+d/9ylnWaEbVsLwaPYlixUAwbnND8Pp3pqqhpwgXhyYPTJId9ea6PnWZEHNrqLuLfRsE8BcBe+wqyTQo8cyaljk7VB/YijRsZfPWXjFF11oWGMzXPxZ9UeUM2eku4EdwxejVTUDSXeSSqqFLdTURcqh/ZMR49uUmeuMet/qqJ2ZIWoPS42dTri51eXF1+Wv3++uLr6Og69H46jqUaOhf7I5Hgcet8bh75b8GVyasdSCV0vtjythJ/ZGoSnEVedv8GpFcJ8+ryoOp7lxREu5fRLnbNtjpc7N+0WLxBo9vxC8QK87MA6wKhuHXHGPYcGrJZySX6hTV5lfAIu6Df9yIP1nKBf70Yuc5lBybCnLOKCqKJxwIFukWtID+gjENv0muPEhqd/QM2BlOqTdtkfXvSB2eSn6AXFqca87zklu5ylOZzq06LNKP8wvdi4/mjz3KAObrS8usE+WYSMaw4Mz4sW0SQxJ8zA4BkYzGWFM9TS2L9DPW3kPV1VZ1Bk5YXoitb4GGTJa5S0p9gMBK6BYCOJKU+/uO2jZsuGXtL58lN34dFfLOkudgYSx0CSCLkW95tyl1MVdL0l7mFbRNG4P7PD8JqW+HbVgZ4BwTYgKFuw2cEzkbqvxuOL2gCBqMc2a1Yj8lopDy0Xi7ezCKy4a1Aurn+7uB5KuRZaB6puaLYeeuCwSzky1VdT9UC0UAOjT14s4wspT07kW06vcQXUaJrN1XEo4D4KFVTww7Vkrj6/DPhV1EonWBxZ5RE5n4IO2jnfwXXtft0zWGSNd/A3mttTltKa7vhuv9TLNN0z3P4DNB1ZGZmyOroENYk61nSZcq/QdCcabS6esuuBlAuZ2LGiEFfbvDvPUFNuTAUWX8zAEBoYnt9nLN1EivBxmDNQBAaKg02NrCJeV+z0C5aJJinWVc2afMNn7O0be+snJvHei5fWbEPH9eO4Z45o+wwMnoFhXBE0J///tB2OHJ6P2g5lOera9Ivr5eVPl+dny4sDaXdCyx/otRo4Iu2HU2M1tRvw1MDok5dKuxvItho1PtYaI28vyc90P0HnwEypc1iZO8kcvr3cgH4mTVs/X+g70YvdfrUfoXkQreBRzUNqGSHUoqduiLUEarWb17FgTQn6R2v1ZpbiI+dKXtbD2qek2uqb31N8/coTJp6sjHn40rFmZdldPM6DYRswzN3Vq9YAEEQPJQUfcc7Pbt+qblOXwcHjn/HdvDSc2kot5D0InMqDUSf16euXg2yD6uKaGaR+P8y1g4kLNVH/7qrfh/NffAmi4wB2eE/y0DDuUR5mihDzyl5obG1ILL6hYT0pqHjfFY+yMNYxAxVfv+RQcY5Ip/2rym7jwNh49Cqry+eW1iD1GzjBkyTLmHofVBZzsiqqnf4XWUYfMh2Cb0IYPrytKnyj1I+hx9yvSTa+YdK3Uf0Nk7ylMi+Y+jndSD+pu1/qVu5G/gulrbxICmVuZHN0cmVhbQplbmRvYmoKNyAwIG9iago8PAovVHlwZSAvUGFnZQovUGFyZW50IDMgMCBSCi9SZXNvdXJjZXMgPDwKL0ZvbnQgPDwKL0ZjcGRmMCA5IDAgUgovRmNwZGYxIDEwIDAgUgo+PgovUHJvY1NldCA0IDAgUiA+PgovTWVkaWFCb3ggWzAgMCA2MTIgNzkyXQovQ3JvcEJveCBbMCAwIDYxMiA3OTJdCi9Sb3RhdGUgMAovQ29udGVudHMgOCAwIFIKPj4KZW5kb2JqCjggMCBvYmoKPDwKL0xlbmd0aCAxMjYwCi9GaWx0ZXIgWy9GbGF0ZURlY29kZV0KPj4Kc3RyZWFtCnictVjbbuM2EH3XV/Ctu8BGK1KiKPUtmzqNi2IRxMYCRXcRyBIdsStLri52/fcdSqRMS05i5/JEezyaOaM5c0iauLbjOIhR1q7U99sVk3YpuTWzrC9z6/N1vE6WYHda+3xpYfnBQc7Boowk6Fbmg51K/5X1YTb7E82buihFlKHvB1+/f/yI5v9Yk7mRC5+YC0My5lKGmBfamKlk07zmZc5rHZeoMj3arsQjNmX4kTJPTc2w7WEWIuayfearTPC8y/sk7BDbAQv8w4dnvNzwcgjadVVPsE3gCRM09rzW9pTP+YX52KaUQGGEGtigYacWF0B67PrjAMcLJPj5Ap/wIT5tu8ncsDW6ENcD+DjQPr2HijL2OKR5cMpbcqH/gctYyyoS+l2Vkw28oRueif/suFh9br/O6iYRBQLOHeP5ackCZnsOhmSE2S4lXTLsXfzRZBeOh4j7K/VgrG6jB47I8YHqE70EAA3tkEFa5oQ2dVWx33gpljtUp1x19pcKXfGyFksRRzUf9tnx7UBG9MN2DW2iX75jE6kTWytwbd9z+0ategPuhCmTnOgQbR9h9otkBMaRBaAifgiMDfQsT+7m0+vp1eV8cv9tcje9/ktXpFD5odNWsrJwyOwQGKUtEuffP5CDEos43sFPprOrnHsLtLmzDJ/KrNT68oLCFPU9CAQBD1UKiXxZlKuqbWDVNhA+RmCvURpVaCPbK3hi/A4NjscNfsNGBCDnRDaChUYjbi6//j65v5re3kzu7me3k6thI5g3fLfKcqwRR5zZsBFyuA8b0Qd8bSNYsG/EHN5s3DWj4nnStWJcLgItWUV5YqN5Kir97Vkh3uf0jZwiT9ruVV2zZca4gA0zrytULFHVLCr+byMhSckueVyUCUqiOpIQa7ToBj4+bS/YQ6AGhKQpRf7QCQfkqHhViSJHW5FlaMERz+Nyt655Wy9H9GKxq7mJJuVRwssKRSU/A4FnIMi5ZPs+0TtQWe5VFDvAZdcQlevp1+nsZvLbkMHuSB3cx6XkiPNISshISty3khLXe4bBusjjvAXdibMmAQJGKBEPvKqBd2f0kRjpI2CMplEKsas0+sl1IsXwNNpwtMyKLUjZgtdbznODwkgigq9nAMAGAKWbzRrVBYSBKteFyOthxVU3POCziTIB08Q7bHmRczl15wFwDAB9rW2Cdck3omiqbPcJbVMRp23hT5SthP305NTcSJq8HyHIx0uOogyO3lz2GDKLh7R+j9HSuwQN8Cm7hJ4Aynw1N7CryqnTBmPG1DwecQ2Va2/QIzd45NXzRQPncL4Ux95zh6DMeXSHkDNm7AqjrUDBe0LUz8DhGzgOtoL3VGjqsccVumcP3BoPKaEMR9gzdqUD9rjhgD19sNeyx/OfYc+7qjNcDt5GnRXss9WZEgOA0rqROr/8DwfYfNqVYmyHfhi2aS5rI/gnU2XjKG/ffFfSbrXidSliMMUlr9FPvuuA7ctd1vtziRwnOItvRZ22PutmkcHD8ik4CHGx6XT24HgOr/r5d6VrcIwajHO9IkQ/eyZcWVCRZzt5Tku4dmgqPfrrUmzk7ga+MkxTdd5GiRA5WmRcFq4CtL+uQC/k7XVwa/TC7hyj/5oixs1/dG10tGjrocJhP6F6jPd3y36wDa/+cjmMrXH0sRU+M/TeR1sMp3Hk3vI/cabGbAplbmRzdHJlYW0KZW5kb2JqCjkgMCBvYmoKPDwKL1R5cGUgL0ZvbnQKL1N1YnR5cGUgL1R5cGUxCi9OYW1lIC9GY3BkZjAKL0Jhc2VGb250IC9UaW1lcy1Cb2xkCi9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nCj4+CmVuZG9iagoxMCAwIG9iago8PAovVHlwZSAvRm9udAovU3VidHlwZSAvVHlwZTEKL05hbWUgL0ZjcGRmMQovQmFzZUZvbnQgL1RpbWVzLVJvbWFuCi9FbmNvZGluZyAvV2luQW5zaUVuY29kaW5nCj4+CmVuZG9iagoxMSAwIG9iago8PAovUGFyZW50IDIgMCBSCi9BIDw8Ci9UeXBlIC9BY3Rpb24gL1MgL1VSSSAvVVJJIChodHRwOi8vd3d3LkV2ZW50SGVsaXguY29tL0V2ZW50U3R1ZGlvLykKPj4KL1RpdGxlIChFdmVudEhlbGl4LmNvbS9FdmVudFN0dWRpbyAyLjUpCi9OZXh0IDEyIDAgUgo+PgplbmRvYmoKMTIgMCBvYmoKPDwKL1BhcmVudCAyIDAgUgovRGVzdCBbNSAwIFIgL1hZWiAwIDc2OSAwLjAwMF0KL1RpdGxlIChTU0wgVHV0b3JpYWwpCi9QcmV2IDExIDAgUgo+PgplbmRvYmoKMTMgMCBvYmoKPDwKL0NyZWF0b3IgKEV2ZW50SGVsaXguY29tL0V2ZW50U3R1ZGlvIDIuNSkKL0NyZWF0aW9uRGF0ZSAoRDoyMDA0MDcxNDIzNTQzNSkKL1Byb2R1Y2VyIChbQ2xpYlBERiBMaWJyYXJ5IDIuMDItcjEtMV0gV2luZG93cyA5eC9OVCkKL0F1dGhvciAoVXNlcjogV2luZG93cyBOVC85NS85OCBVc2VyKQovVGl0bGUgKFNTTCBUdXRvcmlhbCkKL1N1YmplY3QgKE1lc3NhZ2UgU2VxdWVuY2UgQ2hhcnQpCi9LZXl3b3JkcyAoTWVzc2FnZSBTZXF1ZW5jZSBDaGFydCwgU2NlbmFyaW8gRGlhZ3JhbSkKPj4KZW5kb2JqCnhyZWYKMCAxNAowMDAwMDAwMDAwIDY1NTM1IGYgCjAwMDAwMDAwMzMgMDAwMDAgbiAKMDAwMDAwMDEyMSAwMDAwMCBuIAowMDAwMDAwMTk0IDAwMDAwIG4gCjAwMDAwMDAyNTkgMDAwMDAgbiAKMDAwMDAwMDI4NyAwMDAwMCBuIAowMDAwMDAwNDgwIDAwMDAwIG4gCjAwMDAwMDM1MTMgMDAwMDAgbiAKMDAwMDAwMzcwNiAwMDAwMCBuIAowMDAwMDA1MDQxIDAwMDAwIG4gCjAwMDAwMDUxNTMgMDAwMDAgbiAKMDAwMDAwNTI2NyAwMDAwMCBuIAowMDAwMDA1NDMzIDAwMDAwIG4gCjAwMDAwMDU1MzUgMDAwMDAgbiAKdHJhaWxlcgo8PAovU2l6ZSAxNAovUm9vdCAxIDAgUgovSW5mbyAxMyAwIFIKPj4Kc3RhcnR4cmVmCjU4MzMKJSVFT0YK\",\"name\":\"xyz.pdf\"}]}";


    @Test
    public void shouldTestSerializer() throws Exception{
        SendEmail email = new SendEmail();
        email.setEmailTo(Collections.singletonList(EMAIL_TO));

        SendEmailAttachment sendEmailAttachment = new SendEmailAttachment();
        sendEmailAttachment.setName(FILENAME_TO_SERIALIZE);
        byte[] encode = Files.readAllBytes(Paths.get(getPathToFile()));
        sendEmailAttachment.setContent(encode);

        email.setAttachment(Collections.singletonList(sendEmailAttachment));

        String serializedJson = jsonToTest.serialize(email);
        assertThat(serializedJson,CoreMatchers.equalTo(StringEscapeUtils.unescapeJava(EXPECTED_JSON_PAYLOAD)));
        assertThat(serializedJson, CoreMatchers.containsString(XYZ_FILE_BASE64_CODE));
        assertThat(serializedJson, CoreMatchers.containsString(EMAIL_TO));
        assertThat(serializedJson, CoreMatchers.containsString(FILENAME_TO_SERIALIZE));
    }

    @Test
    public void shouldTestDeserializer() throws Exception{
        SendEmail email = new SendEmail();
        email.setEmailTo(Collections.singletonList(EMAIL_TO));

        SendEmailAttachment sendEmailAttachment = new SendEmailAttachment();
        sendEmailAttachment.setName(FILENAME_TO_SERIALIZE);
        byte[] encode = Files.readAllBytes(Paths.get(getPathToFile()));
        sendEmailAttachment.setContent(encode);

        email.setAttachment(Collections.singletonList(sendEmailAttachment));
        String serializedJson = jsonToTest.serialize(email);

        SendEmail deserializedSendEmail = jsonToTest.deserialize(serializedJson, SendEmail.class);

        assertThat(getEncoder().encodeToString(deserializedSendEmail.getAttachment().get(0).getContent()), CoreMatchers.equalTo(XYZ_FILE_BASE64_CODE));
        assertThat(deserializedSendEmail.getEmailTo().get(0), CoreMatchers.containsString(EMAIL_TO));
        assertThat(deserializedSendEmail.getAttachment().get(0).getName(), CoreMatchers.containsString(FILENAME_TO_SERIALIZE));
    }

    public String getPathToFile() throws IOException {
        ClassLoader classLoader = this.getClass().getClassLoader();
        File file = new File(classLoader.getResource(FILENAME_TO_SERIALIZE).getFile());
        return file.getPath();
    }
}